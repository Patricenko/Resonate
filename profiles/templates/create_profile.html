{% extends "base.html" %}
{% load form_tags %}
{% block title %}Create Profile - Dinter{% endblock %}

{% block content %}
<div class="row justify-content-center" style="min-height: 600px;">
  <!-- Form column -->
  <div class="col-md-7 d-flex flex-column">
    <div class="form-with-validation flex-grow-1 d-flex flex-column p-4">
      <h2 class="mb-4 text-center text-pink">Create Your Dinter Profile</h2>
      <form method="POST" enctype="multipart/form-data" novalidate class="flex-grow-1 d-flex flex-column">
        {% csrf_token %}
        <div class="row g-3 flex-grow-1">
          {% for field in form %}
            <div class="{% if field.name in 'bio interests social_links' %}col-12{% else %}col-md-6{% endif %}">
              {% if field.name == 'is_public' %}
                <div class="form-check d-flex align-items-center">
                  <label for="{{ field.id_for_label }}" class="form-check-label me-5 mb-0" style="cursor: pointer;">
                    {{ field.label }}
                  </label>
                  {{ field|add_class:"form-check-input" }}
                </div>
                {% if field.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in field.errors %}
                      {{ error }}<br>
                    {% endfor %}
                  </div>
                {% endif %}
              {% else %}
                <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>

                {# Apply Autocomplete only to 'location' field #}
                {% if field.name == 'location' %}
                  {{ field|add_class:"form-control" }}
                {% else %}
                  {{ field|add_class:"form-control" }}
                {% endif %}

                {% if field.errors %}
                  <div class="text-danger small mt-1">
                    {% for error in field.errors %}
                      {{ error }}<br>
                    {% endfor %}
                  </div>
                {% endif %}
              {% endif %}
            </div>
          {% endfor %}
        </div>
        <button type="submit" class="form-submit mt-4 w-100">Create Profile</button>
      </form>
    </div>
  </div>

  <!-- Preview column -->
  <div class="col-md-5 d-none d-md-flex align-items-center">
    <div class="p-4 bg-dark rounded shadow w-100" style="min-height: 450px;">
      <h4 class="text-pink mb-3">Profile Preview</h4>
      <p><strong>Username:</strong> {{ user.username }}</p>
      <p><strong>Email:</strong> {{ user.email }}</p>
      <p><em>Preview updates after form submission.</em></p>
    </div>
  </div>
</div>
<!-- Google Maps JavaScript API with Places -->
<script src="https://maps.googleapis.com/maps/api/js?key={{GOOGLE_API_KEY}}&libraries=places" defer></script>

<!-- Load the new Place Autocomplete Web Component -->
<script type="module" src="https://unpkg.com/@googlemaps/places-autocomplete-element"></script>

<script>
  window.addEventListener('load', function () {
    const input = document.getElementById('id_location');
    if (!input) return;

    const autocomplete = new google.maps.places.Autocomplete(input, {
      types: ['geocode'],  // or ['address']
      componentRestrictions: { country: ['sk', 'cz'] } // ak chceš obmedziť
    });

    autocomplete.addListener('place_changed', function () {
      const place = autocomplete.getPlace();
      if (!place.geometry) {
        console.log("No geometry found for place:", place);
        return;
      }
      // V prípade potreby: napr. ulož aj latitude/longitude
      console.log("Selected place:", place.formatted_address);
    });
  });
</script>
{% endblock %}